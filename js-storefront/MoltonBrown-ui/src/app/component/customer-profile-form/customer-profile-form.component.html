<section class="customer_profile-form">
  <form [formGroup]="registrationForm" (ngSubmit)="onSubmitForm($event, true)" class="registration_form"
    style="clear:both" custom-focus>
    <h6 class="title profile">Add a New Address</h6>
    <div class="col-xs-12 row">
      <div class="col-sm-12 col-md-4  ">
        <label class="register_label " for="reg_firstname">First Name<span class="redstar">*</span></label>
      </div>
      <div class="col-sm-12 col-md-8 text-left ">
        <span class="login_fields">
          <input formControlName="firstName" type="text" autocomplete="off" class="mandatory form-control reg_field "
            [ngClass]="{
              'has-error  not-valid':
                !registrationForm.controls['firstName'].valid &&
                registrationForm.get('firstName').touched
            }" />
          <div *ngIf="
              !registrationForm.controls['firstName'].valid &&
              registrationForm.get('firstName').touched
            " class="not-valid-error-msg">
            <span [hidden]="!registrationForm.controls['firstName'].errors.required">
              {{ "register.firstName" | translate }}
            </span>
            <span *ngIf="
                registrationForm.controls['firstName'].errors.patternInvalid
              ">
              {{ "register.firstName" | translate }}
            </span>
          </div>
        </span>
      </div>
    </div>
    <div class="col-xs-12 row">
      <div class="col-sm-12 col-md-4  ">
        <label class="register_label " for="reg_lastname">Last Name<span class="redstar">*</span></label>
      </div>
      <div class="col-sm-12 col-md-8 text-left ">
        <span class="login_fields">
          <input type="text" formControlName="lastName" class="mandatory form-control reg_field " [ngClass]="{
              'has-error  not-valid':
                !registrationForm.controls['lastName'].valid &&
                registrationForm.get('lastName').touched
            }" />
          <div *ngIf="
              !registrationForm.controls['lastName'].valid &&
              registrationForm.get('lastName').touched
            " class="not-valid-error-msg">
            <span [hidden]="!registrationForm.controls['lastName'].errors.required">
              {{ "register.lastName" | translate }}
            </span>
            <span *ngIf="
                registrationForm.controls['lastName'].errors.patternInvalid
              ">
              {{ "register.lastName" | translate }}
            </span>
          </div>
        </span>
      </div>
    </div>

    <div class="col-xs-12 row">
      <div class="col-sm-12 col-md-4  ">
        <label class="register_label " for="reg_country">Country<span class="redstar">*</span></label>
      </div>
      <div class="col-sm-12 col-md-8 text-left ">
        <span class="login_fields">
          <select class="form-control mandatory" formControlName="country" (change)="onChangeCountry($event)" [ngClass]="{
              'has-error  not-valid':
                !registrationForm.controls['country'].valid &&
                registrationForm.get('country').touched
            }">
            <option value="" selected>Choose Country *</option>
            <option *ngFor="let data of countries; let k = index" [ngValue]="data">{{ data.name }}</option>
          </select>
          <div *ngIf="
              !registrationForm.controls['country'].valid &&
              registrationForm.get('country').touched
            " class="not-valid-error-msg">
            <span [hidden]="!registrationForm.controls['country'].errors.required">
              {{ "register.country" | translate }}</span>
          </div>
        </span>
      </div>
    </div>

    <div class="col-xs-12 row" *ngIf="loadGMscript">
      <div class="col-sm-12 col-md-4 ">
        <label class="register_label " for="reg_postcode">Postcode/Zipcode<span class="redstar">*</span></label>
      </div>
      <div class="col-sm-12 col-md-8 text-left ">
        <span class="login_fields">
          <input
             #myInput 
             (onSelect)="setAddress($event)" 
             type="text" 
             maxlength="10"
             googlePlaces
             class="mandatory form-control" 
             formControlName="postalCode" 
             (keyup)="onSearchKeyUp($event)"
             [ngClass]="{
              'has-error  not-valid':(!registrationForm.controls['postalCode'].valid && registrationForm.get('postalCode').touched) ,
              'not-valid-postcode': !postCodeStatus
            }" />
            <span class="postcode-status" *ngIf="!postCodeStatus">Please enter a valid postcode or enter the address manually.</span>
          <div *ngIf="
              !registrationForm.controls['postalCode'].valid &&
              registrationForm.get('postalCode').touched
            " class="not-valid-error-msg">
            
            <span [hidden]="
                !registrationForm.controls['postalCode'].errors?.required
              ">
              {{ "register.postCode" | translate }}</span>
            <span [hidden]="
              !registrationForm.controls['postalCode'].errors.patternInvalid
            ">Please enter a valid postcode</span>
          </div>
        </span>
        <span class="ml-8 find-address" *ngIf="ukLoopBtnStatus">
          <button class="buttonStyle mt-1" (click)="onLookupAddress($event)">
            Lookup Address
          </button>
        </span>
      </div>
    </div>
    <div class="col-xs-12 row " *ngIf="postalAddresses">
      <div class="col-sm-12 col-md-4  ">
        <label class="register_label ">Select Address<span class="redstar">*</span></label>
      </div>
      <div class="col-sm-12 col-md-8 text-left">
        <select class="mandatory form-control" formControlName="address" (change)="onSelectPlace($event.target.value)"
          [ngClass]="{
            'has-error  not-valid':
              !registrationForm.controls['address'].valid &&
              registrationForm.get('address').touched
          }">
          <option value="">Select an Address</option>
          <option *ngFor="let data of postalAddresses; let k = index" [value]="data.Id">{{ data.StreetAddress }},
            &nbsp;{{ data.Place }}</option>
        </select>
      </div>
    </div>

    <div class="col-xs-12 row">
      <div class="col-sm-12 col-md-4  ">
        <label class="register_label " for="reg_address">Address<span class="redstar">*</span></label>
      </div>
      <div class="col-sm-12 col-md-8 text-left ">
        <span class="login_fields">
          <input type="text" value="" formControlName="line1" class="mandatory form-control reg_field " [ngClass]="{
              'has-error  not-valid':
                !registrationForm.controls['line1'].valid &&
                registrationForm.get('line1').touched
            }" />
          <div *ngIf="
              !registrationForm.controls['line1'].valid &&
              registrationForm.get('line1').touched
            " class="not-valid-error-msg">
            <span [hidden]="!registrationForm.controls['line1'].errors.required">
              {{ "register.line1" | translate }}</span>
          </div>
          <input type="text" value="" class="mandatory" style="margin-top:15px;" formControlName="line2" />
        </span>
      </div>
    </div>
    <div class="col-xs-12 row">
      <div class="col-sm-12 col-md-4  ">
        <label class="register_label " for="reg_town">Town/City<span class="redstar">*</span></label>
      </div>
      <div class="col-sm-12 col-md-8 text-left ">
        <span class="login_fields">
          <input type="text" class="mandatory form-control reg_field " formControlName="town" [ngClass]="{
              'has-error  not-valid':
                !registrationForm.controls['town'].valid &&
                registrationForm.get('town').touched
            }" />
          <div *ngIf="
              !registrationForm.controls['town'].valid &&
              registrationForm.get('town').touched
            " class="not-valid-error-msg">
            <span [hidden]="!registrationForm.controls['town'].errors.required">
              {{ "register.town" | translate }}</span>
          </div>
        </span>
      </div>
    </div>
    <div class="col-xs-12 row" *ngIf="!usSpecificForm; else usStates">
      <div class="col-sm-12 col-md-4 ">
        <label class="register_label " for="reg_town">{{ "form.label.state" | translate }}</label>
      </div>
      <div class="col-sm-12 col-md-8 text-left ">
        <span class="login_fields">
          <input type="text" formControlName="district" />
        </span>
      </div>
    </div>
    <ng-template #usStates>
      <div class="col-xs-12 row">
        <div class="col-sm-12 col-md-4 ">
          <label class="register_label " for="reg_town">{{ "form.label.state" | translate }}<span class="redstar">*</span></label>
        </div>
        <div class="col-sm-12 col-md-8 text-left ">
          <span class="login_fields">
            <select *ngIf="stateList" class="mandatory form-control" formControlName="district"  [ngClass]="{
              'has-error  not-valid':
                !registrationForm.controls['district'].valid &&
                registrationForm.get('district').touched
            }">
              <option value="" selected>Choose State* </option>
              <option *ngFor="let data of stateList; let k = index" [ngValue]="data">{{ data.name }}</option>
            </select>
             <div *ngIf="!registrationForm.controls['district'].valid &&
            registrationForm.get('district').touched
        " class="not-valid-error-msg">
          <span *ngIf="registrationForm.controls['district'].errors.required">What's your state</span>

        </div>
            <input *ngIf="!stateList" autocorrect="off" formControlName="district" placeholder="County (optional)"
              type="text" class="form-control  mandatory" autocapitalize="on" [ngClass]="{
                'has-error not-valid':
                  !registrationForm.get('district').valid &&
                  registrationForm.get('district').touched
              }" />   <div *ngIf="!registrationForm.controls['district'].valid &&
              registrationForm.get('district').touched
          " class="not-valid-error-msg">
            <span *ngIf="registrationForm.controls['district'].errors.required">What's your state</span>

          </div>
          </span>
       
        </div>
      </div>
    </ng-template>

    <div class="col-xs-12 row">
      <div class="col-sm-12 col-md-4  ">
        <label class="register_label " for="reg_town">Phone Number<span class="redstar">*</span></label>
      </div>
      <div class="col-sm-12 col-md-8 text-left ">
        <span class="login_fields regPhone">
          <a class="contextual-help"
            show-delay="100"></a>

          <input
                type="text"
                formControlName="phone" 
                class="form-control  mandatory" 
                [ngClass]="{
              'has-error not-valid':
                (!registrationForm.get('phone').valid &&
                  registrationForm.get('phone').touched) ||
                registrationFormInvalid
            }" />
          <a class="registrationForm contextual-help" 
             show-delay="500" ngbTooltip="{{'register.phonenumberInfo'|translate}}" placement="right" ></a>
          <div *ngIf="
              (!registrationForm.controls['phone'].valid &&
                registrationForm.get('phone').touched) ||
              (isValidFormSubmitted != null && !isValidFormSubmitted)
            " class="not-valid-error-msg">
            <span *ngIf="registrationForm.controls['phone'].errors.required">what's your contact telephone
              number?</span>
            <span *ngIf="registrationForm.controls['phone'].errors.patternInvalid">
              This telephone number doesn't look right. It must be between 10
              and 14 characters.
            </span>
          </div>
        </span>
      </div>
    </div>

    <div class="col-sm-12 text-right" style="padding: 15px;">
      <button class="buttonStyle" type="submit">
        {{ updateAddress ? "Update" : "Save" }}
      </button>
    </div>
  </form>
  <div class="text-left update_btn" style="padding: 15px;">
    <button class="buttonStyle" (click)="onUpdate()">
      {{ updateAddress ? "Cancel" : "Clear" }}
    </button>
  </div>
</section>