<div>
  <div class="delivery-wrap" *ngIf="!loading; else loader">
    <div *ngIf="hazardous">
      <p class="err_msg">
        {{ hazardousData.description }}
      </p>
      <div style="padding:5px;">
        <li class="err_msg" *ngFor="let data of hazardousData.list">
          {{ data }}
        </li>
      </div>
    </div>
    <div class="section-heading">
      <h2>Where do you want us to deliver ?</h2>
    </div>
    <section
      class="delivery-section-panel-body"
      [ngClass]="{
         'regUser-block': switchAddressMode, 
         'regUser-hide': !switchAddressMode 
        }"
    >
      <fieldset>
        <form>
          <div class="existing-reg-field-block delivery-radio-button">
            <div
              class="form-inline delivery-radio-block"
              *ngFor="let address of addressList; let k = index">
              <div class="radio existing-customer-list">
                <input
                  name="address"
                  type="radio"
                  class="password-radio"
                  [checked]="address.defaultAddress"
                  (change)="onAddressChange(address, k)"
                />
                <label for="passwordRadios2" class="radio-inline address_label">
                  {{ address.firstName + "  " + address.lastName }},
                  <span *ngIf="address.line1">{{ address.line1 + "," + " " + address.line2 }},</span>
                  <span *ngIf="address.town"> {{ address.town }},</span>&nbsp;
                  <span *ngIf="address.postalCode">{{ address.postalCode }},&nbsp;</span>
                  <span *ngIf="address.country">{{ address.country.name }}.</span>
                </label>
              </div>
              <div class="action-link">
                <span (click)="editAddress(address, k)">
                  edit
                </span>
              </div>
            </div>

            <div class="form-group reg-add-address">
              <a (click)="addAddress()">Add new address</a>
            </div>
            <div class="reg-confirm-address">
              <div class="form-group clearfix">
                <button
                  (click)="onSelectAddress()"
                  class="btn btn-default pull-right"
                >
                  CONFIRM ADDRESS
                </button>
              </div>
            </div>
          </div>
        </form>
      </fieldset>
    </section>
    <section
      class="delivery-new-form-body personal-details"
      *ngIf="showDeliveryForm"
    >
      <form
        class="shippment_form"
        [formGroup]="shipmentForm"
        (ngSubmit)="onSubmitForm($event)"
        custom-focus
      >
        <fieldset>
          <div class="section-heading"  *ngIf="reguser">
          <legend>
            {{ (updateAddress) ? "Edit address" : "Add new address" }}
          </legend>
         </div>
          <div class="form-group">
            <select
              formControlName="titleCode"
              class="mandatory form-control selectDropdown cntry-select"
              [ngClass]="{
                'has-error  not-valid':
                  !shipmentForm.controls['titleCode'].valid &&
                  shipmentForm.get('titleCode').touched,
                valid: shipmentForm.get('titleCode').valid,
                invalid: !shipmentForm.get('titleCode').valid
              }"
            >
              <option value="" selected>Title*</option>
              <option value="miss">Miss</option>
              <option value="mrs">Mrs</option>
              <option value="ms">Ms</option>
              <option value="mr">Mr</option>
              <option value="dr">Dr</option>
            </select>
            <div
              *ngIf="
                !shipmentForm.controls['titleCode'].valid &&
                shipmentForm.get('titleCode').touched
              "
              class="not-valid-error-msg"
            >
              <span *ngIf="shipmentForm.controls['titleCode'].errors.required"
                >Please select a title</span
              >
            </div>
          </div>
          <div class="form-group">
            <input
              autocorrect="off"
              formControlName="firstName"
              placeholder="First name*"
              type="text"
              class="form-control  mandatory"
              autocapitalize="on"
              [ngClass]="{
                'has-error not-valid':
                  !shipmentForm.get('firstName').valid &&
                  shipmentForm.get('firstName').touched,
                valid: shipmentForm.get('firstName').valid,
                invalid: !shipmentForm.get('firstName').valid
              }"
            />
            <div
              *ngIf="
                !shipmentForm.controls['firstName'].valid &&
                shipmentForm.get('firstName').touched
              "
              class="not-valid-error-msg"
            >
              <span *ngIf="shipmentForm.controls['firstName'].errors.required">
                What's your first name ?
              </span>
              <span
                *ngIf="shipmentForm.controls['firstName'].errors.patternInvalid"
              >
                What's your first name ?
              </span>
            </div>
          </div>
          <div class="form-group">
            <input
              autocorrect="off"
              formControlName="lastName"
              placeholder="Last name*"
              type="text"
              class="form-control  mandatory"
              autocapitalize="on"
              [ngClass]="{
                'has-error not-valid':
                  !shipmentForm.get('lastName').valid &&
                  shipmentForm.get('lastName').touched,

                valid: shipmentForm.get('lastName').valid,
                invalid: !shipmentForm.get('lastName').valid
              }"
            />
            <div
              *ngIf="
                !shipmentForm.controls['lastName'].valid &&
                shipmentForm.get('lastName').touched
              "
              class="not-valid-error-msg"
            >
              <span *ngIf="shipmentForm.controls['lastName'].errors.required">
                What's your last name?
              </span>
              <span
                *ngIf="shipmentForm.controls['lastName'].errors.patternInvalid"
              >
                What's your last name?
              </span>
            </div>
          </div>
          <div class="form-group">
              <a
              class="contextual-help"
              show-delay="100"  ngbTooltip="{{'register.phonenumberInfo'|translate}}" placement="right" 
            ></a>
            <input
              autocorrect="off"
              formControlName="phone"
              placeholder="Telephone number*"
              type="text"
              class="telInput  mandatory form-control reg_field"
              autocapitalize="on"
              [ngClass]="{
                'has-error not-valid':
                  !shipmentForm.get('phone').valid &&
                  shipmentForm.get('phone').touched,
                valid: shipmentForm.get('phone').valid,
                invalid: !shipmentForm.get('phone').valid
              }"
            />
            <!-- {{shipmentForm.controls['phone'].errors |json}} -->
            
            <div
              *ngIf="
                !shipmentForm.controls['phone'].valid &&
                shipmentForm.get('phone').touched
              "
              class="not-valid-error-msg"
            >
              <span *ngIf="shipmentForm.controls['phone'].errors.required"
                >What's your contact telephone number?</span
              >
              <span
                *ngIf="shipmentForm.controls['phone'].errors.patternInvalid"
              >
                This telephone number doesn't look right. It must be between 10
                and 14 characters.
              </span>
            </div>
        

          </div>

          <!-- <app-custom-select *ngIf="countries" [countries]="countries"></app-custom-select> -->
          <div class="form-group">
            <div
              class="form-inline marginB"
              style="justify-content: flex-start;"
            >
              <div class="form-group">
                <select
                  class="mandatory form-control selectDropdown cntry-select"
                  formControlName="country"
                  (change)="onChangeCountry($event)"
                  [ngClass]="{
                    'has-error  not-valid':
                      !shipmentForm.controls['country'].valid &&
                      shipmentForm.get('country').touched,
                    valid: shipmentForm.get('country').valid,
                    invalid: !shipmentForm.get('country').valid
                  }"
                >
                
                  <option value="" selected>Choose Country *</option>
                  <option
                    *ngFor="let data of countries; let k = index"
                    [ngValue]="data"
                    >{{ data.name }}</option
                  >
                </select>
                <div
                  *ngIf="
                    !shipmentForm.controls['country'].valid &&
                    shipmentForm.get('country').touched
                  "
                  class="not-valid-error-msg"
                >
                  <span *ngIf="shipmentForm.controls['country'].errors.required"
                    >Please select a country</span
                  >
                </div>
              </div>
              <span *ngIf="ukSpecificForm">
                <span
                  class="help-block inline postcodesearchreset"
                  *ngIf="!manualAdress"
                  style="display: inline;"
                >
                  <a (click)="onSearchByPostal()">Search using postcode</a>
                </span>
              </span>
            </div>
          </div>
          <div *ngIf="ukSpecificForm"></div>
          <div
            class="form-inline manual_field"
            *ngIf="manualAdress; else fullDetail"
          >
            <div class="form-group">
              <input
                type="text"
                formControlName="line1"
                placeholder="House no."
                class="form-control short-field"
              />
            </div>
            <div class="form-group" custom-focus>
              <input
                type="text"
                formControlName="postalCode"
                autocapitalize="characters"
                (keyup)="onPostCodeKeyUp($event)"   
                             
                placeholder="Postcode*"
                maxlength="10"
                #myInput
                class="form-control short-field postC"
                [ngClass]="{
                  'has-error not-valid':(!shipmentForm.get('postalCode').valid && shipmentForm.get('postalCode').touched),
                  'valid': (shipmentForm.get('postalCode').valid && postCodeStatus),
                  'not-valid-postcode has-error not-valid ': !postCodeStatus
                }"
              />
              <div
                *ngIf="(!shipmentForm.controls['postalCode'].valid &&
                    shipmentForm.get('postalCode').touched)"
                class="not-valid-error-msg"
              >
              <span class="postcode-status" *ngIf="!postCodeStatus">Please enter a valid postCode or enter the address manually.</span>
                <span
                  *ngIf="shipmentForm.controls['postalCode'].errors?.required"
                  >Please select a post Code</span
                >
              </div>
              <div class="postcode-msg-block">
                <span>Please enter a valid postCode or enter the address manually.</span>
              </div>
            </div>
            <button
              *ngIf="ukSpecificForm"
              class="btn btn-default btn-find-address"
              (click)="findAddress($event)"
            >
              FIND ADDRESS
            </button>
            <span *ngIf="ukSpecificForm" class="help-block"
              >Or <a (click)="addressManual()">enter address manually</a></span
            >
          </div>
          <div class="form-group" *ngIf="postalAddresses">
            <div class="form-inline" style="justify-content: flex-start;">
              <div class="form-group">
                <select
                  class="mandatory form-control selectDropdown slct-address"
                  formControlName="address"
                  (change)="onSelectPlace($event.target.value)"
                >
                  <option value="null" selected>Select an Address</option>
                  <option
                    *ngFor="let data of postalAddresses; let k = index"
                    [value]="data.Id"
                    >{{ data.StreetAddress }}, &nbsp;{{ data.Place }}</option
                  >
                </select>
              </div>
              <span
                class="help-block inline postcodesearchreset"
                *ngIf="!manualAdress"
                style="display: inline;"
              >
                <!-- <a (click)="onSearchByPostal()">Search using postcode</a> -->
              </span>
            </div>
          </div>
          <ng-template #fullDetail>
            <div class="form-group">
              <input
                autocorrect="off"
                formControlName="line1"
                placeholder="Address line 1*"
                type="text"
                class="form-control  mandatory"
                autocapitalize="on"
                [ngClass]="{
                  'has-error not-valid':
                    !shipmentForm.get('line1').valid &&
                    shipmentForm.get('line1').touched,
                  valid: shipmentForm.get('line1').valid,
                  invalid: !shipmentForm.get('line1').valid
                }"
              />
              <div
                *ngIf="
                  !shipmentForm.controls['line1'].valid &&
                  shipmentForm.get('line1').touched
                "
                class="not-valid-error-msg"
              >
                <span *ngIf="shipmentForm.controls['line1'].errors.required">
                  What's the first line of the address?
                </span>
              </div>
            </div>
            <div class="form-group">
              <input
                autocorrect="off"
                formControlName="line2"
                placeholder="Address line 2 (optional)"
                type="text"
                class="form-control  mandatory"
                autocapitalize="on"
              />
            </div>
            <div class="form-group">
              <input
                autocorrect="off"
                formControlName="town"
                placeholder="City*"
                type="text"
                class="form-control  mandatory"
                autocapitalize="on"
                [ngClass]="{
                  'has-error not-valid':
                    !shipmentForm.get('town').valid &&
                    shipmentForm.get('town').touched,
                  valid: shipmentForm.get('town').valid,
                  invalid: !shipmentForm.get('town').valid
                }"
              />
              <div
                *ngIf="
                  !shipmentForm.controls['town'].valid &&
                  shipmentForm.get('town').touched
                "
                class="not-valid-error-msg"
              >
                <span *ngIf="shipmentForm.controls['town'].errors.required">
                  Please enter a city.
                </span>
              </div>
            </div>
            <div class="form-group">
              <input
                *ngIf="!usSpecificForm; else usStates"
                autocorrect="off"
                formControlName="district"
                placeholder="County (optional)"
                type="text"
                class="form-control  mandatory"
                autocapitalize="on"
              />
              <ng-template #usStates>
                <select
                  *ngIf="stateList"
                  class="mandatory form-control selectDropdown"
                  formControlName="district"
                >
                  <option value="" selected>Choose State *</option>
                  <option
                    *ngFor="let data of stateList; let k = index"
                    [ngValue]="data"
                    >{{ data.name }}</option
                  >
                </select>
                <input
                  *ngIf="!stateList"
                  autocorrect="off"
                  formControlName="district"
                  placeholder="{{ 'form.label.state' | translate }} *"
                  type="text"
                  class="form-control  mandatory"
                  autocapitalize="on"
                />
              </ng-template>
            </div>
            <div class="form-group">
              <input
                autocorrect="off"
                formControlName="postalCode"
                placeholder="Postcode*"
                type="text"
                class="form-control  mandatory"
                autocapitalize="on"
                [ngClass]="{
                  'has-error not-valid':
                    !shipmentForm.get('postalCode').valid &&
                    shipmentForm.get('postalCode').touched,
                  valid: shipmentForm.get('postalCode').valid,
                  invalid: !shipmentForm.get('postalCode').valid
                }"
              />
              <div
                *ngIf="
                  !shipmentForm.controls['postalCode'].valid &&
                  shipmentForm.get('postalCode').touched
                "
                class="not-valid-error-msg"
              >
                <span
                  *ngIf="shipmentForm.controls['postalCode'].errors?.required"
                >
                  What's your postcode?
                </span>
                <span
                  [hidden]="
                    !shipmentForm.controls['postalCode'].errors.patternInvalid
                  "
                  >Please enter a valid postcode</span
                >
              </div>
            </div>
          </ng-template>
          <div
            class="form-group shippingButtons"
            [ngClass]="{ 'f-space-between': currentUser }"
          >
            <button
              class="btn btn-default disabled-active"
              (click)="onResetForm()"
              *ngIf="currentUser"
            >
              CANCEL
            </button>
            <div class="pull-right" *ngIf="!manualAdress">
              <button
                class="btn btn-default "
                *ngIf="updateAddress; else guestUserBtn"
              >
                SAVE CHANGES
              </button>
              <ng-template #guestUserBtn>
                <button class="btn btn-default ">
                  {{ currentUser ? "SAVE ADDRESS" : "CONFIRM DETAILS" }}
                </button>
              </ng-template>
            </div>
          </div>
        </fieldset>
      </form>
    </section>
  </div>
  <ng-template #loader>
    <div class="loading-backdrop">
      <div class="b2c-title">
        <span class="loading-txt"> loading... </span> 
      </div>
    </div>
  </ng-template>
</div>
